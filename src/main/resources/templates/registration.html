<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head_info"></head>
<body>
<header th:replace="fragments/header :: head"></header>
<section id="register">
    <div class="register-form-container">
        <div class="register-form">
            <div class="auth-logo">
                <img src="../static/img/DimasosLogo.png" th:src="@{/img/DimasosLogo.png}" alt="">
            </div>
            <div class="form-content">
                <div th:if="${param.success}">
                    <div class="alert alert-info">
                        Wow. Successful registration drove up. Now you can fully enjoy the content of this
                        site. But it is not exactly...
                    </div>
                </div>
                <form th:action="@{/registration}" th:object="${user}" method="post">
                    <p class="error-message alert alert-warning"
                       th:if="${#fields.hasGlobalErrors()}"
                       th:each="error : ${#fields.errors('global')}"
                       th:text="${error}">Smth goes wrong</p>

                    <div class="form-group">
                        <label for="lastName">Surname</label>
                        <input type="text" class="form-control"
                               th:classappend="${#fields.hasErrors('lastName')}? 'is-invalid':''"
                               th:field="*{lastName}" id="lastName" placeholder="Surname" required>
                        <div class="invalid-feedback" th:each="error: ${#fields.errors('lastName')}"
                             th:text="${error}">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="firstName">Name</label>
                        <input type="text" class="form-control"
                               th:classappend="${#fields.hasErrors('firstName')}? 'is-invalid':''"
                               th:field="*{firstName}" id="firstName" placeholder="Name" required>
                        <div class="invalid-feedback" th:each="error: ${#fields.errors('firstName')}"
                             th:text="${error}">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="faculty">Faculty</label>
                        <select class="custom-select" id="faculty" th:field="*{faculty}"
                                th:classappend="${#fields.hasErrors('faculty')}? 'is-invalid':''" required>
                            <option value="">Select faculty</option>
                            <option th:each="facultys : ${facultys}" th:value="${facultys.id}"
                                    th:text="${facultys.faculty}">
                            </option>
                        </select>
                        <div class="invalid-feedback" th:each="error: ${#fields.errors('faculty')}"
                             th:text="${error}">
                        </div>
                    </div>

                    <div id="subjects" class="d-none">
                        <div class="form-group">
                            <label for="mark1" id="subject0-title">Subject 1</label>
                            <input type="text" class="form-control" id="mark1" th:field="*{mark1}" pattern="[0-9]*"
                                   th:classappend="${#fields.hasErrors('faculty')}? 'is-invalid':''" required>
                            <div class="invalid-feedback" th:each="error: ${#fields.errors('mark1')}"
                                 th:text="${error}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="mark2" id="subject1-title">Subject 2</label>
                            <input type="text" class="form-control" id="mark2" th:field="*{mark2}" pattern="[0-9]*"
                                   th:classappend="${#fields.hasErrors('faculty')}? 'is-invalid':''" required>
                            <div class="invalid-feedback" th:each="error: ${#fields.errors('mark2')}"
                                 th:text="${error}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="mark3" id="subject2-title">Subject 3</label>
                            <input type="text" class="form-control" id="mark3" th:field="*{mark3}" pattern="[0-9]*"
                                   th:classappend="${#fields.hasErrors('faculty')}? 'is-invalid':''" required>
                            <div class="invalid-feedback" th:each="error: ${#fields.errors('mark3')}"
                                 th:text="${error}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="certificate" id="certificate-title">Certificate</label>
                            <input type="text" class="form-control" id="certificate" th:field="*{certificate}"
                                   pattern="[0-9]*"
                                   th:classappend="${#fields.hasErrors('faculty')}? 'is-invalid':''" required>
                            <div class="invalid-feedback" th:each="error: ${#fields.errors('certificate')}"
                                 th:text="${error}">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="email">E-mail</label>
                        <input type="text" class="form-control"
                               th:classappend="${#fields.hasErrors('email')}? 'is-invalid':''"
                               th:field="*{email}" id="email" placeholder="E-mail" required>
                        <div class="invalid-feedback" th:each="error: ${#fields.errors('email')}"
                             th:text="${error}">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" class="form-control"
                               th:classappend="${#fields.hasErrors('password')}? 'is-invalid':''"
                               th:field="*{password}" id="password" required>
                        <div class="invalid-feedback" th:each="error: ${#fields.errors('password')}"
                             th:text="${error}">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword">Re-enter password</label>
                        <input type="password" class="form-control"
                               th:classappend="${#fields.hasErrors('confirmPassword')}? 'is-invalid':''"
                               th:field="*{confirmPassword}" id="confirmPassword" required>
                        <div class="invalid-feedback" th:each="error: ${#fields.errors('confirmPassword')}"
                             th:text="${error}">
                        </div>
                    </div>

                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input"
                               th:classappend="${#fields.hasErrors('terms')}? 'is-invalid':''" id="terms"
                               th:field="*{terms}" required>
                        <label class="custom-control-label" for="terms">
                            I agree with <a href="#">terms</a> of university.
                        </label>
                        <div class="invalid-feedback"
                             th:each="error : ${#fields.errors('terms')}"
                             th:text="${error}">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-success mt-3 mb-3">Sign out</button>
                    <span>Already registered? <a href="/" th:href="@{/login}">Sign in here</a></span>
                </form>
            </div>
        </div>
    </div>
</section>
<footer th:replace="fragments/footer :: footer"></footer>
<div th:replace="fragments/footer :: scripts"></div>
<script>
    function updateNames(e) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState === 4) {
                var arr = this.responseText.split("\n");

                console.log(arr);

                if (arr.length > 0 && this.responseText.length > 0 && this.status === 200) {
                    var counter = 0;
                    for (var subject in arr) {
                        $("#subject" + counter + "-title").text(arr[subject]);

                        counter++;
                    }

                    $("#subjects").removeClass("d-none");
                } else {
                    $("#subjects").addClass("d-none");
                }
            }
        };

        var selected = e[e.selectedIndex];
        xhttp.open("GET", "/AJAX/subjects?id=" + selected.value, true);
        xhttp.send();
    }

    var facultySelect = $("#faculty");

    facultySelect.change(function (e) {
        updateNames(this);
    });

    updateNames(facultySelect[0]);
</script>
</body>
</html>